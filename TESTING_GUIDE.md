# Gmail MCP Server æµ‹è¯•æŒ‡å—

æœ¬é¡¹ç›®æä¾›äº†å®Œæ•´çš„æµ‹è¯•å·¥å…·é“¾ï¼ŒåŒ…æ‹¬å¿«é€ŸéªŒè¯å·¥å…·å’Œå…¨é¢çš„æµ‹è¯•æ¡†æ¶ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„æµ‹è¯•éœ€æ±‚ã€‚

## ğŸ“‹ æµ‹è¯•æ–‡ä»¶æ¦‚è§ˆ

### ğŸš€ æµ‹è¯•è¿è¡Œå™¨

| æ–‡ä»¶ | ç±»å‹ | ç”¨é€” | å¤æ‚åº¦ |
|------|------|------|--------|
| `run_tests.py` | pytestè¿è¡Œå™¨ | æ­£å¼æµ‹è¯•æ¡†æ¶å…¥å£ | é«˜ |
| `quick_test.py` | ç®€å•APIæµ‹è¯• | å¿«é€ŸåŠŸèƒ½éªŒè¯ | ä½ |
| `test_api.sh` | Shellè„šæœ¬ | å‘½ä»¤è¡ŒAPIæµ‹è¯• | ä¸­ |

### ğŸ§ª æµ‹è¯•æ¨¡å— (tests/ ç›®å½•)

| æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | é‡è¦æ€§ |
|------|----------|--------|
| `test_health.py` | æœåŠ¡å™¨å¥åº·æ£€æŸ¥ | â­â­â­ |
| `test_messages.py` | é‚®ä»¶åŠŸèƒ½æµ‹è¯• | â­â­â­ |
| `test_labels.py` | æ ‡ç­¾ç®¡ç†æµ‹è¯• | â­â­â­ |
| `test_mcp.py` | MCPåè®®æµ‹è¯• | â­â­â­ |
| `test_trash.py` | åƒåœ¾ç®±åŠŸèƒ½æµ‹è¯• | â­â­ |
| `test_integration.py` | é›†æˆæµ‹è¯• | â­â­ |
| `conftest.py` | pytesté…ç½®å’Œfixtures | â­â­â­ |
| `test_utils.py` | æµ‹è¯•å·¥å…·å‡½æ•° | â­â­ |

## ğŸ› ï¸ æµ‹è¯•å·¥å…·è¯¦è§£

### 1. run_tests.py - æ­£å¼æµ‹è¯•è¿è¡Œå™¨

**åŠŸèƒ½ç‰¹ç‚¹**:
- ğŸ”§ ç¯å¢ƒæ£€æŸ¥å’Œä¾èµ–éªŒè¯
- ğŸ“Š å¤šç§æµ‹è¯•æ¨¡å¼é€‰æ‹©
- ğŸ“ˆ è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆ
- ğŸ“„ HTMLæµ‹è¯•æŠ¥å‘Š
- âš¡ å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ
- ğŸ” çµæ´»çš„æµ‹è¯•è¿‡æ»¤

**ä½¿ç”¨æ–¹æ³•**:
```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èæ—¥å¸¸å¼€å‘ä½¿ç”¨ï¼‰
python run_tests.py --quick

# å®Œæ•´æµ‹è¯•å¥—ä»¶
python run_tests.py

# å†’çƒŸæµ‹è¯•ï¼ˆæœ€åŸºæœ¬éªŒè¯ï¼‰
python run_tests.py --smoke

# é›†æˆæµ‹è¯•
python run_tests.py --integration

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python run_tests.py --coverage

# ç”ŸæˆHTMLæŠ¥å‘Š
python run_tests.py --html

# å¹¶è¡Œè¿è¡Œï¼ˆ4ä¸ªè¿›ç¨‹ï¼‰
python run_tests.py --parallel 4

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
python run_tests.py --file tests/test_health.py

# è¿‡æ»¤ç‰¹å®šæµ‹è¯•
python run_tests.py --filter "test_health"

# è¯¦ç»†è¾“å‡º
python run_tests.py --verbose
```

**æµ‹è¯•æ¨¡å¼è¯´æ˜**:
- `--quick`: è¿è¡Œæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼Œè·³è¿‡æ…¢é€Ÿæµ‹è¯•
- `--smoke`: æœ€åŸºæœ¬çš„åŠŸèƒ½éªŒè¯ï¼Œç¡®ä¿æœåŠ¡å¯ç”¨
- `--integration`: ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
- `--slow`: åŒ…å«è€—æ—¶è¾ƒé•¿çš„æµ‹è¯•
- `--destructive`: åŒ…å«å¯èƒ½ä¿®æ”¹Gmailæ•°æ®çš„æµ‹è¯•ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

### 2. quick_test.py - å¿«é€ŸéªŒè¯å·¥å…·

**åŠŸèƒ½ç‰¹ç‚¹**:
- âš¡ å¿«é€Ÿæ‰§è¡Œï¼ˆé€šå¸¸<10ç§’ï¼‰
- ğŸ¯ ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½éªŒè¯
- ğŸ“± æœ€å°ä¾èµ–è¦æ±‚
- ğŸ” ç®€æ´çš„è¾“å‡ºæ ¼å¼

**ä½¿ç”¨æ–¹æ³•**:
```bash
# ä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„token
python quick_test.py

# æŒ‡å®šaccess token
python quick_test.py your_jwt_token_here

# æŒ‡å®šæœåŠ¡å™¨åœ°å€
python quick_test.py your_token http://localhost:8000
```

**æµ‹è¯•å†…å®¹**:
1. âœ… æœåŠ¡å™¨å¥åº·æ£€æŸ¥
2. âœ… JWT tokenéªŒè¯
3. âœ… MCPå·¥å…·åˆ—è¡¨è·å–
4. âœ… åŸºæœ¬APIç«¯ç‚¹æµ‹è¯•

### 3. test_api.sh - Shellè„šæœ¬æµ‹è¯•

**åŠŸèƒ½ç‰¹ç‚¹**:
- ğŸš çº¯Shellè„šæœ¬ï¼Œæ— Pythonä¾èµ–
- ğŸ”§ ä½¿ç”¨curlè¿›è¡ŒHTTPæµ‹è¯•
- ğŸ“‹ é€æ­¥éªŒè¯å„ä¸ªç«¯ç‚¹
- ğŸ¨ å½©è‰²è¾“å‡ºæ˜¾ç¤º

**ä½¿ç”¨æ–¹æ³•**:
```bash
# åŸºæœ¬æµ‹è¯•
./test_api.sh

# æŒ‡å®šæœåŠ¡å™¨åœ°å€
./test_api.sh http://localhost:8000

# æŒ‡å®šJWT token
JWT_TOKEN="your_token" ./test_api.sh
```

## ğŸ“ æµ‹è¯•æ¨¡å—è¯¦è§£

### æ ¸å¿ƒæµ‹è¯•æ¨¡å—

#### test_health.py - å¥åº·æ£€æŸ¥æµ‹è¯•
```python
# æµ‹è¯•å†…å®¹
- æœåŠ¡å™¨è¿é€šæ€§
- å¥åº·æ£€æŸ¥ç«¯ç‚¹
- APIæ ¹ç«¯ç‚¹å“åº”
- åŸºæœ¬é”™è¯¯å¤„ç†
```

#### test_messages.py - é‚®ä»¶åŠŸèƒ½æµ‹è¯•
```python
# æµ‹è¯•å†…å®¹
- é‚®ä»¶åˆ—è¡¨è·å–
- å•ä¸ªé‚®ä»¶è¯¦æƒ…
- æœç´¢åŠŸèƒ½
- åˆ†é¡µåŠŸèƒ½
- é”™è¯¯å¤„ç†
```

#### test_labels.py - æ ‡ç­¾ç®¡ç†æµ‹è¯•
```python
# æµ‹è¯•å†…å®¹
- æ ‡ç­¾åˆ—è¡¨è·å–
- æ·»åŠ æ ‡ç­¾åˆ°é‚®ä»¶
- ä»é‚®ä»¶ç§»é™¤æ ‡ç­¾
- æ ‡ç­¾éªŒè¯
- æ‰¹é‡æ“ä½œ
```

#### test_mcp.py - MCPåè®®æµ‹è¯•
```python
# æµ‹è¯•å†…å®¹
- MCPå·¥å…·å‘ç°
- å·¥å…·è°ƒç”¨æ¥å£
- å‚æ•°éªŒè¯
- å“åº”æ ¼å¼éªŒè¯
- é”™è¯¯å¤„ç†
```

### æ”¯æŒæ–‡ä»¶

#### conftest.py - pytesté…ç½®
```python
# æä¾›åŠŸèƒ½
- æµ‹è¯•fixtures
- ç¯å¢ƒé…ç½®
- è®¤è¯tokenç”Ÿæˆ
- æµ‹è¯•æ•°æ®å‡†å¤‡
- æ¸…ç†å‡½æ•°
```

#### test_utils.py - æµ‹è¯•å·¥å…·
```python
# å·¥å…·å‡½æ•°
- JWT tokenç”Ÿæˆ
- HTTPè¯·æ±‚å°è£…
- å“åº”éªŒè¯
- æµ‹è¯•æ•°æ®ç”Ÿæˆ
- æ–­è¨€è¾…åŠ©å‡½æ•°
```

## ğŸ¯ æµ‹è¯•ç­–ç•¥

### 1. å¼€å‘é˜¶æ®µæµ‹è¯•
```bash
# æ—¥å¸¸å¼€å‘ - å¿«é€Ÿåé¦ˆ
python quick_test.py

# åŠŸèƒ½å¼€å‘ - ç›¸å…³æ¨¡å—æµ‹è¯•
python run_tests.py --file tests/test_messages.py

# æäº¤å‰ - å¿«é€Ÿæµ‹è¯•
python run_tests.py --quick
```

### 2. é›†æˆæµ‹è¯•
```bash
# å®Œæ•´åŠŸèƒ½éªŒè¯
python run_tests.py --integration

# ç«¯åˆ°ç«¯æµ‹è¯•
python run_tests.py
```

### 3. éƒ¨ç½²éªŒè¯
```bash
# ç”Ÿäº§ç¯å¢ƒå¿«é€Ÿæ£€æŸ¥
python quick_test.py

# å†’çƒŸæµ‹è¯•
python run_tests.py --smoke
```

### 4. CI/CD æµæ°´çº¿
```bash
# å¹¶è¡Œæ‰§è¡Œï¼Œç”ŸæˆæŠ¥å‘Š
python run_tests.py --parallel 4 --coverage --html
```

## ğŸ“Š æµ‹è¯•è¦†ç›–èŒƒå›´

### åŠŸèƒ½è¦†ç›–
- âœ… **é‚®ä»¶ç®¡ç†**: åˆ—è¡¨ã€è¯¦æƒ…ã€æœç´¢ã€åˆ†é¡µ
- âœ… **æ ‡ç­¾ç®¡ç†**: è·å–ã€æ·»åŠ ã€åˆ é™¤ã€æ‰¹é‡æ“ä½œ
- âœ… **åƒåœ¾ç®±æ“ä½œ**: ç§»åŠ¨åˆ°åƒåœ¾ç®±ã€æ¢å¤
- âœ… **MCPåè®®**: å·¥å…·å‘ç°ã€è°ƒç”¨ã€å‚æ•°éªŒè¯
- âœ… **è®¤è¯ç³»ç»Ÿ**: JWTéªŒè¯ã€Google OAuth2
- âœ… **é”™è¯¯å¤„ç†**: å„ç§å¼‚å¸¸æƒ…å†µ

### æµ‹è¯•ç±»å‹
- ğŸ” **å•å…ƒæµ‹è¯•**: ç‹¬ç«‹åŠŸèƒ½æ¨¡å—
- ğŸ”— **é›†æˆæµ‹è¯•**: æ¨¡å—é—´äº¤äº’
- ğŸŒ **APIæµ‹è¯•**: HTTPæ¥å£éªŒè¯
- ğŸ¥ **å¥åº·æ£€æŸ¥**: æœåŠ¡å¯ç”¨æ€§
- ğŸš¨ **é”™è¯¯æµ‹è¯•**: å¼‚å¸¸å¤„ç†éªŒè¯

## ğŸš¨ æ³¨æ„äº‹é¡¹

### æµ‹è¯•ç¯å¢ƒè¦æ±‚
1. **æœåŠ¡å™¨è¿è¡Œ**: ç¡®ä¿Gmail MCP Serveråœ¨localhost:12000è¿è¡Œ
2. **ä¾èµ–å®‰è£…**: `pip install -r requirements.txt`
3. **ç¯å¢ƒå˜é‡**: é…ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡æˆ–.envæ–‡ä»¶

### æµ‹è¯•æ•°æ®å®‰å…¨
- ğŸ”’ æµ‹è¯•ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œä¸ä¼šå½±å“çœŸå®Gmailè´¦æˆ·
- ğŸ›¡ï¸ TestCredentialsç±»é˜²æ­¢çœŸå®APIè°ƒç”¨
- âš ï¸ é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œç ´åæ€§æµ‹è¯•

### æ€§èƒ½è€ƒè™‘
- âš¡ quick_test.py: ~5-10ç§’
- ğŸƒ --quickæ¨¡å¼: ~30ç§’
- ğŸš¶ å®Œæ•´æµ‹è¯•: ~2-5åˆ†é’Ÿ
- ğŸŒ --slowæ¨¡å¼: ~10åˆ†é’Ÿ+

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡å™¨è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
curl http://localhost:12000/health

# å¯åŠ¨æœåŠ¡å™¨
python main.py
```

#### 2. è®¤è¯å¤±è´¥
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $TEST_ACCESS_TOKEN

# é‡æ–°ç”Ÿæˆtoken
python -c "from tests.test_utils import generate_test_token; print(generate_test_token())"
```

#### 3. ä¾èµ–ç¼ºå¤±
```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install -r requirements.txt

# æ£€æŸ¥pytestå®‰è£…
python -m pytest --version
```

#### 4. æµ‹è¯•å¤±è´¥åˆ†æ
```bash
# è¯¦ç»†è¾“å‡ºæ¨¡å¼
python run_tests.py --verbose

# è¿è¡Œå•ä¸ªå¤±è´¥çš„æµ‹è¯•
python run_tests.py --file tests/test_health.py --verbose
```

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

### è¦†ç›–ç‡æŠ¥å‘Š
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python run_tests.py --coverage

# æŸ¥çœ‹æŠ¥å‘Š
open htmlcov/index.html
```

### HTMLæµ‹è¯•æŠ¥å‘Š
```bash
# ç”ŸæˆHTMLæŠ¥å‘Š
python run_tests.py --html

# æŸ¥çœ‹æŠ¥å‘Š
open report.html
```

## ğŸ‰ æœ€ä½³å®è·µ

1. **å¼€å‘æ—¶**: ä½¿ç”¨`quick_test.py`è·å¾—å¿«é€Ÿåé¦ˆ
2. **åŠŸèƒ½æµ‹è¯•**: ä½¿ç”¨`run_tests.py --quick`éªŒè¯æ ¸å¿ƒåŠŸèƒ½
3. **æäº¤å‰**: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿è´¨é‡
4. **éƒ¨ç½²å**: ä½¿ç”¨å†’çƒŸæµ‹è¯•éªŒè¯éƒ¨ç½²æˆåŠŸ
5. **CI/CD**: ä½¿ç”¨å¹¶è¡Œæµ‹è¯•å’ŒæŠ¥å‘Šç”Ÿæˆæé«˜æ•ˆç‡

---

**æµ‹è¯•æ˜¯ä»£ç è´¨é‡çš„ä¿éšœï¼Œé€‰æ‹©åˆé€‚çš„æµ‹è¯•å·¥å…·èƒ½å¤Ÿæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç å¯é æ€§ï¼** ğŸš€